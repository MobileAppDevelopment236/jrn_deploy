<!DOCTYPE html>
<html>
<head>
    <title>Password Reset</title>
    <script>
        // Enhanced recovery handler with cross-platform token storage
        function handleRecovery() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const type = urlParams.get('type');
            
            console.log('üîê Recovery handler:', { token, type });
            
            if (token && type === 'recovery') {
                // Store in multiple locations for redundancy
                
                // 1. localStorage (for Flutter SharedPreferences access)
                localStorage.setItem('password_reset_required', 'true');
                localStorage.setItem('reset_timestamp', new Date().toISOString());
                localStorage.setItem('supabase_recovery_token', token);
                localStorage.setItem('supabase_recovery_type', 'recovery');
                
                // 2. sessionStorage (for web session)
                sessionStorage.setItem('supabase_recovery_token', token);
                sessionStorage.setItem('supabase_recovery_type', 'recovery');
                sessionStorage.setItem('supabase_recovery_timestamp', new Date().toISOString());
                
                console.log('üîê Recovery tokens stored in multiple locations');
                
                // Redirect to main app - Flutter will detect the reset requirement
                const appUrl = `https://www.jrrgo.com/`;
                console.log('üîÑ Redirecting to main app:', appUrl);
                window.location.href = appUrl;
            } else {
                console.error('‚ùå Invalid recovery parameters');
                // Redirect to main app anyway
                window.location.href = 'https://www.jrrgo.com/';
            }
        }
        
        // Start processing when page loads
        document.addEventListener('DOMContentLoaded', handleRecovery);
    </script>
</head>
<body>
    <p>Processing password reset...</p>
</body>
</html>