<!DOCTYPE html>
<html>
<head>
    <title>Authentication Callback</title>
    <script>
    function processAuthCallback() {
        try {
            const url = new URL(window.location.href);
            console.log('üîê Full URL:', url.href);
            console.log('üîê URL Fragment:', url.hash);
            
            // Extract parameters from fragment (#access_token=...)
            const fragment = url.hash.substring(1); // Remove the '#'
            const params = new URLSearchParams(fragment);
            
            const token = params.get('access_token');
            const type = params.get('type');
            
            console.log('üîê Auth Callback Processing:', { 
                token: !!token, 
                type: type,
                fullFragment: fragment
            });
            
            if (token && type === 'recovery') {
                console.log('üéØ Password reset token detected');
                
                // Store in localStorage
                localStorage.setItem('password_reset_required', 'true');
                localStorage.setItem('supabase_recovery_token', token);
                localStorage.setItem('supabase_recovery_type', type);
                localStorage.setItem('reset_timestamp', new Date().toISOString());
                
                console.log('‚úÖ Password reset tokens stored in localStorage');
                console.log('üì¶ Stored values:');
                console.log('   - password_reset_required:', localStorage.getItem('password_reset_required'));
                console.log('   - supabase_recovery_token:', localStorage.getItem('supabase_recovery_token') ? 'PRESENT' : 'null');
                console.log('   - supabase_recovery_type:', localStorage.getItem('supabase_recovery_type'));
                
                // ‚úÖ FIX: REDIRECT WITH TOKENS IN QUERY PARAMETERS
                const redirectUrl = `https://www.jrrgo.com/?access_token=${token}&type=${type}`;
                console.log('üîÑ Redirecting with tokens:', redirectUrl);
                window.location.href = redirectUrl;
                return; // Important: stop execution here
            } else {
                console.log('‚ùå No valid token found in URL');
                console.log('   - Token:', token);
                console.log('   - Type:', type);
            }
            
        } catch (error) {
            console.error('‚ùå Auth callback error:', error);
        }
        
        // Fallback redirect without tokens
        console.log('üîÑ Redirecting to main app (no tokens)...');
        window.location.href = 'https://www.jrrgo.com/';
    }
    
    // Run immediately when page loads
    console.log('üöÄ Auth callback page loaded');
    processAuthCallback();
</script>
</head>
<body>
    <p>Processing authentication... Redirecting to app.</p>
</body>
</html>