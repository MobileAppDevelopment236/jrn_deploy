<!DOCTYPE html>
<html>
<head>
  <title>Password Reset - JRR Immigration</title>
  <script>
    console.log("üîê Auth callback loaded");
    console.log("üìç URL:", window.location.href);

    function getParams() {
      const hash = window.location.hash.substring(1);
      return new URLSearchParams(hash);
    }

    function storeRecoveryData({ email, accessToken, type }) {
      console.log("üíæ Storing recovery data‚Ä¶");

      localStorage.setItem("supabase_recovery_email", email);
      localStorage.setItem("supabase_recovery_token", accessToken);
      localStorage.setItem("supabase_recovery_type", type);
      localStorage.setItem("password_reset_required", "true");

      console.log("‚úÖ Stored:", { email, accessToken, type });
    }

    function redirectToApp() {
      console.log("üîÑ Redirecting back to app‚Ä¶");

      // Clean URL (remove sensitive data)
      window.history.replaceState({}, document.title, "/auth-callback.html");

      setTimeout(() => {
        window.location.replace("https://www.jrrgo.com/?reset_initiated=true");
      }, 300);
    }

    function init() {
      const params = getParams();

      const accessToken = params.get("access_token");
      const type = params.get("type");
      const email = params.get("email");

      console.log("üì¶ Extracted:", { accessToken, type, email });

      if (!accessToken || !email || type !== "recovery") {
        console.error("‚ùå Missing required recovery params");
        redirectToApp();
        return;
      }

      storeRecoveryData({
        email,
        accessToken,
        type
      });

      redirectToApp();
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</head>
<body style="font-family: Arial; text-align:center; padding:40px;">
  <h1 style="color:#0D97CE;">Processing Password Reset‚Ä¶</h1>
  <p>Please wait while we prepare your password reset session.</p>
</body>
</html>
